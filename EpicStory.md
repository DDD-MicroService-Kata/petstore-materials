# 原始需求清单

## [PET-01] 作为顾客，我希望能注册一个新用户，以便将来能管理我的个人信息和订单。

> 假设实际账户创建由外部SSO服务处理，系统仅仅需要管理顾客用户个人信息。

```
AC1：GIVEN 进入创建新用户界面
     AND 界面提示需要输入的信息包括用户名、密码、性别、邮箱和电话号码
     WHEN 该电话和邮箱均未被使用，且用户名长度不超过20字
     THEN 展示创建用户成功页面，用户信息被记录下来
     WHEN 提供的电话或邮箱已经存在，或用户名长度超过20字
     THEN 停留在用户创建界面，并在界面上告知出错原因
```

## [PET-02] 作为顾客，我希望在登录后能查看到我的个人信息，以便我知道这些信息是否是正确的。

> 假设登录功能由外部SSO服务承担，并在API Gateway处理，所有到达系统内部的请求都是已经通过身份验证的。

```
AC1: GIVEN 进入用户登录页面
     AND 输入用户名和密码信息
     WHEN 提供的用户名和密码正确
     THEN 返回首页，进入登录状态
     WHEN 提供的用户名不存在或密码不正确
     THEN 停留在登录页，并提示用户输入有误

AC2: GIVEN 进入用户个人信息页面
     WHEN 用户已登录
     THEN 显示该用户的详细信息
     WHEN 用户未登录
     THEN 跳转到登录页面
```

## [PET-03] 作为顾客，我希望能在登录后能修改个人信息，以便在我的邮箱或电话改变后能更新账号里的相应记录。

```
AC1: GIVEN 点击个人信息页面上的信息编辑按钮
     AND 进入用户个人信息编辑页面，并对个人信息进行修改后点击确认
     WHEN 修改后的电话和邮箱不与已有记录重复，且用户名长度不超过20字
     THEN 返回个人信息页面，展示新的用户信息，且新信息被记录到系统
     WHEN 修改后的电话或邮箱已经存在，或用户名长度超过20字
     THEN 停留在个人信息编辑页面，并提示出错原因 
```

## [PET-04] 作为顾客，我希望能查看网站里出售的所有宠物种类，以便我了解网站是否销售我想要的宠物。

```
AC1: GIVEN 进入网站主页
     THEN 列出所有宠物种类（如🐱、🐶、🐰等）的名称、描述文字和一张示意图片
```

## [PET-05] 作为顾客，我希望能查看网站里特定种类宠物的品类，以便我缩小寻找宠物卖家的范围。

```
AC1: GIVEN 进入网站主页
     WHEN 点击主页上特定宠物类型的名称或图片
     THEN 展开该种类下所有宠物品类列表
     AND 类别中的每一项包含该品类的名称、描述文字和一张示意图片
```

## [PET-06] 作为顾客，我希望能查看特定品类的所有宠物，以便我选择想购买的宠物。

```
AC1: GIVEN 进入网站主页，宠物种类已选择，品类列表已展开
     WHEN 从列出的宠物品类中点击特定一个品类
     THEN 进入宠物展示的页面
     AND 展示的每个宠物的商家名称、商家地址、价格和一张照片
     AND 若宠物数量较多，应该分为多页展示，可前后翻页查看
```

## [PET-07] 作为顾客，我希望能查看选中宠物的详细信息，以便我能决定是否购买。

```
AC1: GIVEN 进入宠物列表的展示页面
     WHEN 点击一个宠物
     THEN 进入宠物详情展示页面，页面中包含该宠物及宠物商家的信息
     AND 商家信息包括名称、地址、简介、电话、一张门店照片
     AND 宠物信息包括价格、剩余数量、详细描述和多张照片
```

## [PET-08] 作为顾客，我希望能购买我看中的宠物，以便我获得该宠物。

> 假设支付功能由第三方服务提供，系统仅处理已支付后的订单记录功能。

> 为简化需求，限制用户每个订单只能购买一种具体的宠物，但可购买多只。且暂不考虑宠物的配送问题。

```
AC1：GIVEN 进入宠物详情页面
     AND 选择购买数量，购买数量不能多于该宠物剩余数量
     WHEN 点击购买按钮
     TEHN 显示购买成功页面，展示订单编号和基本信息
     AND 订单被记录下来，状态为“已成交”
```

```
AC2：GIVEN 用户已经下单
     THEN 相应被购买的宠物剩余数量应该减少相应被购买的数量
     AND 如果减少后宠物剩余数量等于0，在未来查看宠物列表时，该宠物不应该再被展示
```

## [PET-09] 作为顾客，我希望能列出自己的所有订单，以便我查询购买时的信息。

```
AC1：GIVEN 进入订单管理页面
     THEN 页面展示用户所有的订单
     AND 每个订单的展示基本信息，包括订单编号、下单的时间、订单状态(已成交|已退货)
     WHEN 点击某个订单
     THEN 展示该订单详细信息，包括订单编号、下单的时间、订单状态，以及该订单的商家的ID、名称、地址、电话、门店照片，宠物数量、价格、描述和多张照片
```

```
AC2：GIVEN 用户已经下单
     WHEN 订单中涉及的用户、商家或宠物信息发生了变动
     THEN 在订单中记录的用户、商家和宠物信息应该保存不变
```

## [PET-10] 作为顾客，我希望能在对购买的宠物不满意时，可在3天内退货，以便获得必要的消费者保障。

> 假设退款功能由第三方服务提供，系统仅处理已退款后的订单记录更新。假设顾客与店家已通过第三方渠道沟通达成退货意愿。

> 为了简化需求，假设只能一次性退回订单中所有数量的宠物，不能部分退回。且暂不考虑宠物的退货配送问题。

> 为了便于测试，取消订单的时间可由Web端指定。

```
AC1：GIVEN 进入订单管理页面
     WHEN 点击某个订单记录上的“退货”按钮
     THEN 弹出的确认退货提示框

AC2：GIVEN 确认退货的提示框中选择了确认执行退货
     WHEN 退货时间不早于订单时间前72小时
     THEN 提示退货成功，相应订单状态变为“已退货”
     AND 已退回的宠物不需要自动重新上架，后续上架操作由商家自行处理
     WHEN 退货时间在订单时间前72小时以前
     THEN 提升退货失败，并告知出错原因
```

## [PET-99] 作为架构师，我希望系统能处理下单时的事务问题，以避免出现已售出的宠物未及时下架的情况。

> 此需求是为了演示分布式任务中的最终一致性处理方法

```
AC1：GIVEN 顾客购买了特定的宠物
     WHEN 订单系统成功产生订单，但库存系统扣除宠物数量出错（可能是正好已被售出）
     THEN 错误的订单应该被删除，并向用户返回购买失败的错误信息
```

```
AC1：GIVEN 顾客购买了特定的宠物
     WHEN 库存系统扣除宠物数量成功，但订单系统返回错误（可能是系统故障）
     THEN 已扣除的宠物数量应该还原，并向用户返回购买失败的错误信息
```

PS：所有接口如果出现服务器端处理错误均可能返回500，并在返回内容中提供错误信息。
