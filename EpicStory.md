# 原始需求清单

## [PET-01] 作为顾客，我希望能注册一个新用户，以便将来能管理我的个人信息和订单。

> 假设实际账户创建由外部SSO服务处理，系统仅仅需要管理顾客用户个人信息。

```
AC1：GIVEN 系统对Web端提供一个创建用户接口
     AND 该接口输入参数包括用户名、性别、邮箱和电话号码
     WHEN 该电话和邮箱均未被使用，且用户名长度不超过20字
     THEN 返回200，用户被记录下来
     WHEN 提供的电话或邮箱已经存在，或用户名长度超过20字
     THEN 返回400，并在返回信息中告知出错原因
```

## [PET-02] 作为顾客，我希望在登录后能查看到我的个人信息，以便我知道这些信息是否是正确的。

> 假设登录功能由外部SSO服务承担，并在API Gateway处理，所有到达系统内部的请求都是已经通过身份验证的。

```
AC1: GIVEN 系统对Web端提供一个查询指定ID的用户信息的接口
     WHEN 提供的用户ID存在
     THEN 返回200，以及该用户的详细信息
     WHEN 提供的用户ID不存在
     THEN 返回404
```

## [PET-03] 作为顾客，我希望能在登录后能修改个人信息，以便在我的邮箱或电话改变后能更新账号里的相应记录。

```
AC1: GIVEN 系统对Web端提供一个修改用户信息接口
     WHEN 修改后的电话和邮箱不与已有记录重复，且用户名长度不超过20字
     THEN 返回200，新的用户信息被记录到系统
     WHEN 修改后的电话或邮箱已经存在，或用户名长度超过20字
     THEN 返回400，并在返回信息中告知出错原因 
```

## [PET-04] 作为顾客，我希望能查看网站里出售的所有宠物种类，以便我了解网站是否销售我想要的宠物。

```
AC1: GIVEN 系统对Web端提供一个查询所有宠物种类的接口
     THEN 该接口返回200，以及所有宠物种类的名称、描述文章和一张描述图片的URL
```

## [PET-05] 作为顾客，我希望能查看网站里特定种类宠物的品类，以便我缩小寻找宠物卖家的范围。

```
AC1: GIVEN 系统对Web端提供一个查询宠物品类的接口
     AND 调用时需要提供一个宠物种类的ID
     WHEN 提供的种类ID有效
     THEN 返回200，以及该种类下所有宠物品类的名称、描述文章和一张描述图片的URL
     WHEN 提供的种类ID无效
     THEN 返回404
```

## [PET-06] 作为顾客，我希望能查看特定种类和品类的所有宠物，以便我选择想购买的宠物。

```
AC1: GIVEN 系统对Web端提供一个查询宠物列表的接口
     AND 调用时需要提供宠物的种类ID、品类ID、每页显示的记录数量和当前查询的页码
     WHEN 提供的种类ID和品类ID均有效
     THEN 返回200，以及指定数量的宠物信息，包括宠物的商家名称、商家地址，宠物的价格和一张照片的URL
     WHEN 提供的种类ID或品类ID无效
     THEN 返回404
```

## [PET-07] 作为顾客，我希望能查看选中宠物的详细信息，以便我能决定是否购买。

```
AC1: GIVEN 系统对Web端提供一个查询指定宠物详细信息的接口
     AND 调用时需要提供宠物所属的商店ID和宠物ID
     WHEN 提供的商店ID和宠物ID均有效
     THEN 返回200，该宠物及宠物商家的信息，包括商家的名称、地址、简介、电话、一张门店照片URL，宠物的价格、剩余数量、详细描述和多张照片URL
     WHEN 提供的商店ID或宠物ID无效
     THEN 返回404
```

## [PET-08] 作为顾客，我希望能购买我看中的宠物，以便我获得该宠物。

> 假设支付功能由第三方服务提供，系统仅处理已支付后的订单记录功能。

> 为简化需求，限制用户每个订单只能购买一种具体的宠物，但可购买多只。且暂不考虑宠物的配送问题。

```
AC1：GIVEN 系统对Web端提供一个创建订单的接口
     AND 调用时提供用户ID、商店ID、宠物ID和购买数量
     WHEN 提供的用户ID、商店ID和宠物ID均有效，且购买数量不多于该宠物剩余数量
     TEHN 返回200，订单被记录下来，状态为“已成交”，同时返回订单的唯一编号
     WHEN 提供的用户ID、商店ID或宠物ID无效，或购买的数量超过该宠物剩余数量
     THEN 返回400，并在返回信息中告知出错原因 
```

```
AC2：GIVEN 用户已经下单
     THEN 相应被购买的宠物剩余数量应该减少相应被购买的数量
     AND 如果减少后宠物剩余数量等于0，在未来查询宠物列表时，该宠物不应该再被展示
```

## [PET-09] 作为顾客，我希望能列出自己的所有订单，以便我查询购买时的信息。

```
AC1：GIVEN 系统对Web端提供一个查询订单的接口
     AND 调用时提供用户的ID
     WHEN 提供的用户ID有效
     THEN 返回200，以及下单的时间、订单状态(已成交|已退款)、该订单中的用户的ID、电话、邮箱，商家的ID、名称、地址、电话、门店照片URL，宠物的ID、描述和多张照片URL
     WHEN 提供的用户ID无效
     THEN 返回404
```

```
AC2：GIVEN 用户已经下单
     WHEN 订单中涉及的用户、商家或宠物信息发生了变动
     THEN 在订单中记录的用户、商家和宠物信息应该保存不变
```

## [PET-10] 作为顾客，我希望能在对购买的宠物不满意时，可在3天内退货，以便获得必要的消费者保障。

> 假设退款功能由第三方服务提供，系统仅处理已退款后的订单记录更新。假设顾客与店家已通过第三方渠道沟通达成退货意愿。

> 为了简化需求，假设只能一次性退回订单中所有数量的宠物，不能部分退回。且暂不考虑宠物的退货配送问题。

> 为了便于测试，取消订单的时间可由Web端指定。

```
AC1：GIVEN 系统对Web端提供一个取消订单的接口
     AND 调用时提供参数有订单ID和取消的时间
     WHEN 订单ID有效，且退货时间不早于订单时间前72小时
     THEN 相应订单状态变为“已退款”
     AND 已退回的宠物不需要自动重新上架，后续上架操作由商家自行处理
     WHEN 订单ID无效，或退货时间在订单时间前72小时以前
     THEN 返回400，并在返回信息中告知出错原因
```

## [PET-99] 作为架构师，我希望系统能处理下单时的事务问题，以避免出现已售出的宠物未及时下架的情况。

> 此需求做为扩展的思考问题，不需要在Workshop上进行实现。

```
AC1：GIVEN 顾客购买了特定的宠物
     WHEN 订单系统成功产生订单，但库存系统扣除宠物数量出错（可能是正好已被售出）
     THEN 错误的订单应该被删除，并向用户返回购买失败的错误信息
```

```
AC1：GIVEN 顾客购买了特定的宠物
     WHEN 库存系统扣除宠物数量成功，但订单系统返回错误（可能是系统故障）
     THEN 已扣除的宠物数量应该还原，并向用户返回购买失败的错误信息
```

PS：所有接口如果出现服务器端处理错误均可能返回500，并在返回内容中提供错误信息。
